<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Bash on Илья Маринин</title>
    <link>https://www.marinin.pw/ru/tags/bash/</link>
    <description>Recent content in Bash on Илья Маринин</description>
    <generator>Hugo -- 0.138.0</generator>
    <language>ru-RU</language>
    <lastBuildDate>Sat, 18 Nov 2017 23:30:13 +0500</lastBuildDate>
    <atom:link href="https://www.marinin.pw/ru/tags/bash/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Примитивный скрипт закачки файлов на сервер</title>
      <link>https://www.marinin.pw/ru/posts/simple_deploy/</link>
      <pubDate>Sat, 18 Nov 2017 23:30:13 +0500</pubDate>
      <guid>https://www.marinin.pw/ru/posts/simple_deploy/</guid>
      <description>&lt;p&gt;Очень лень закачивать блог на сервер, тыкая в GUI FileZilla.&lt;/p&gt;
&lt;p&gt;После некоторого гугления получился такой код:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#/bin/bash&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;HOST&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;hostname&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;USER&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;username&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PASSWD&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;password&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;LOCALPATH&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/path_to_my_local_folder&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DIR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/path_to_my_server_folder&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sshpass -p &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;$PASSWD&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; scp -r $LOCALPATH $USER@$HOST:$DIR
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Не забываем дать скрипту права на исполнение:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ chmod +x ./deploy.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Скрипт рекурсивно закачивает указанную папку на сервер. Если настроить ключи (что мне пока делать лень), то можно обойтись без &lt;code&gt;sshpass&lt;/code&gt; и пароля соответственно.&lt;/p&gt;
&lt;p&gt;Свой блог теперь закачиваю на сервер именно таким образом.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Очень лень закачивать блог на сервер, тыкая в GUI FileZilla.</p>
<p>После некоторого гугления получился такой код:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#/bin/bash</span>
</span></span><span style="display:flex;"><span>HOST<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;hostname&#39;</span>
</span></span><span style="display:flex;"><span>USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;username&#39;</span>
</span></span><span style="display:flex;"><span>PASSWD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;password&#39;</span>
</span></span><span style="display:flex;"><span>LOCALPATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/path_to_my_local_folder&#39;</span>
</span></span><span style="display:flex;"><span>DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/path_to_my_server_folder&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sshpass -p <span style="color:#e6db74">&#34;</span>$PASSWD<span style="color:#e6db74">&#34;</span> scp -r $LOCALPATH $USER@$HOST:$DIR
</span></span></code></pre></div><p>Не забываем дать скрипту права на исполнение:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ chmod +x ./deploy.sh
</span></span></code></pre></div><p>Скрипт рекурсивно закачивает указанную папку на сервер. Если настроить ключи (что мне пока делать лень), то можно обойтись без <code>sshpass</code> и пароля соответственно.</p>
<p>Свой блог теперь закачиваю на сервер именно таким образом.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Закончилось место на сервере</title>
      <link>https://www.marinin.pw/ru/posts/cannot-create-temp/</link>
      <pubDate>Sun, 16 Apr 2017 11:19:59 +0500</pubDate>
      <guid>https://www.marinin.pw/ru/posts/cannot-create-temp/</guid>
      <description>&lt;p&gt;Начал замечать странности в поведении динамических сайтов на своем сервере. Залогинился и увидел, что перестало работать автодополнение команд. bash ругался таким текстом:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;cannot create temp file for here-document: No space left on device&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Первым делом решил посмотреть какие папки сколько места занимают. Перейдя в корневой раздел, выполнил:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo du -h --max-depth&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; ./
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Папка tmp не разрослась и в целом все в пределах нормы.&lt;/p&gt;
&lt;p&gt;В итоге выполнил&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ sudo apt-get autoremove -y
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Оказалось, что лишних зависимостей в сумме набежало почти на гигабайт.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Начал замечать странности в поведении динамических сайтов на своем сервере. Залогинился и увидел, что перестало работать автодополнение команд. bash ругался таким текстом:</p>
<p><strong>cannot create temp file for here-document: No space left on device</strong></p>
<p>Первым делом решил посмотреть какие папки сколько места занимают. Перейдя в корневой раздел, выполнил:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ sudo du -h --max-depth<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> ./
</span></span></code></pre></div><p>Папка tmp не разрослась и в целом все в пределах нормы.</p>
<p>В итоге выполнил</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ sudo apt-get autoremove -y
</span></span></code></pre></div><p>Оказалось, что лишних зависимостей в сумме набежало почти на гигабайт.</p>
<p>На всякий случай выполнил</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ sudo crontab -e
</span></span></code></pre></div><p>и прописал там</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span> * * * /usr/bin/apt-get autoremove -y &gt;&gt; /var/www/cron.log
</span></span></code></pre></div><p>Теперь лишние зависимости будут оперативно удаляться.</p>
<p><strong>UPD:</strong></p>
<p>Спустя некоторое время место опять закончилось. Оказывается старые версии ядра и заголовки удалились не до конца. Помогли следующие скрипты <a href="https://askubuntu.com/questions/2793/how-do-i-remove-old-kernel-versions-to-clean-up-the-boot-menu">отсюда</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dpkg --list | grep <span style="color:#e6db74">&#39;linux-image&#39;</span> | awk <span style="color:#e6db74">&#39;{ print $2 }&#39;</span> | sort -V | sed -n <span style="color:#e6db74">&#39;/&#39;</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -r | sed <span style="color:#e6db74">&#34;s/\([0-9.-]*\)-\([^0-9]\+\)/\1/&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#39;/q;p&#39;</span> | xargs sudo apt-get -y purge
</span></span><span style="display:flex;"><span>dpkg --list | grep <span style="color:#e6db74">&#39;linux-headers&#39;</span> | awk <span style="color:#e6db74">&#39;{ print $2 }&#39;</span> | sort -V | sed -n <span style="color:#e6db74">&#39;/&#39;</span><span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>uname -r | sed <span style="color:#e6db74">&#34;s/\([0-9.-]*\)-\([^0-9]\+\)/\1/&#34;</span><span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#39;/q;p&#39;</span> | xargs sudo apt-get -y purge
</span></span></code></pre></div><p>Здесь учитывается текущая версия ядра, так что лишнего удалить не получится.</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
